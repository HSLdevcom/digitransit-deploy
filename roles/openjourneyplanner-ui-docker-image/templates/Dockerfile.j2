FROM node:0.12
MAINTAINER Reittiopas version: 0.1

WORKDIR {{openjourneyplanner_ui_root}}

RUN apt-get update
RUN apt-get install -y git npm

RUN echo "{{ansible_date_time.epoch}}"

RUN \
  mkdir -p {{openjourneyplanner_ui_root}} && \
  cd {{openjourneyplanner_ui_root}} && \
  git clone {{openjourneyplanner_ui_git}} . && \
  # Remove livereload
  sed -i '/localhost:9000/d' js/app.html && \
  npm install -g node-sass && \
  npm install -g browserify && \
  npm install && \
  npm run static && \
  npm run css:build && \
  npm run browserify:build

CMD export PORT={{openjourneyplanner_ui_exposed_port}}; node server/server.js
